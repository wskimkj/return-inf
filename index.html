<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>êµ¬ê¸€ì‹œíŠ¸ ìƒí’ˆ ì¡°íšŒ</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #eef2ff, #fefefe);
      font-family: Pretendard, sans-serif;
    }
    th.sortable:hover { cursor: pointer; color: #2563eb; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6 text-blue-700">ğŸ“¦ ìƒí’ˆ ì¡°íšŒ</h1>

  <!-- Search & Filter Section -->
  <div class="flex flex-wrap gap-3 mb-4 items-center">
    <input id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
           class="border px-3 py-2 rounded-lg shadow-sm w-60">

    <select id="colorFilter" class="border px-3 py-2 rounded-lg shadow-sm">
      <option value="">ì»¬ëŸ¬ ì „ì²´</option>
    </select>

    <select id="categoryFilter" class="border px-3 py-2 rounded-lg shadow-sm">
      <option value="">ì¹´í…Œê³ ë¦¬ ì „ì²´</option>
    </select>

    <button id="resetBtn"
            class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
      ì´ˆê¸°í™”
    </button>
  </div>

  <!-- Status -->
  <p id="loadStatus" class="text-sm text-gray-600 mb-2">ë¡œë”© ì¤‘...</p>

  <!-- Table -->
  <div class="w-full max-w-6xl bg-white shadow-xl rounded-xl p-4">
    <table class="w-full">
      <thead>
        <tr class="border-b text-left">
          <th class="p-2 sortable" data-col="0">ìƒí’ˆëª…</th>
          <th class="p-2 sortable" data-col="1">ì»¬ëŸ¬</th>
          <th class="p-2 sortable" data-col="2">ì‚¬ì´ì¦ˆ</th>
          <th class="p-2 sortable" data-col="3">ì¬ê³ </th>
          <th class="p-2">ì°½ê³ (GID)</th>
        </tr>
      </thead>
      <tbody id="resultBody"></tbody>
    </table>
  </div>

<script>
  let rawData = [];
  let dataRows = [];
  let sortState = {};

  const SHEET_URL = "https://docs.google.com/spreadsheets/d/1_Bxfag-90U6u-6JbhxNqeoD9vRns-CpPeXPIJYO1Z5o/export?format=csv&gid=518656308";

  async function loadSheet() {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    rawData = text.split("\n").map(r => r.split(","));
    dataRows = rawData.slice(1);

    loadStatus.textContent = `ë¡œë“œ ì™„ë£Œ (ì´ ${dataRows.length}ê±´)`;

    populateFilters();
    renderTable(dataRows);
  }

  function renderTable(rows) {
    const body = document.getElementById("resultBody");
    body.innerHTML = "";

    rows.forEach(r => {
      const tr = document.createElement("tr");
      tr.className = "border-b hover:bg-indigo-50 transition";

      tr.innerHTML = `
        <td class="p-2">${r[0]}</td>
        <td class="p-2">${r[1]}</td>
        <td class="p-2">${r[2]}</td>
        <td class="p-2">${r[3]}</td>
        <td class="p-2 text-blue-600 underline cursor-pointer">${r[4]}</td>
      `;

      tr.addEventListener("click", () => {
        if (r[4]) window.open(`https://docs.google.com/spreadsheets/d/1_Bxfag-90U6u-6JbhxNqeoD9vRns-CpPeXPIJYO1Z5o/edit#gid=${r[4]}`, "_blank");
      });

      body.appendChild(tr);
    });
  }

  function searchAndFilter() {
    const keyword = searchInput.value.toLowerCase();
    const color = colorFilter.value;
    const category = categoryFilter.value;

    let result = dataRows.filter(r =>
      (!keyword || r.join(" ").toLowerCase().includes(keyword)) &&
      (!color || r[1] === color) &&
      (!category || r[0].includes(category))
    );

    renderTable(result);
  }

  function populateFilters() {
    const colors = [...new Set(dataRows.map(r => r[1]))].filter(v => v);
    colors.forEach(c => colorFilter.innerHTML += `<option>${c}</option>`);

    const categories = [...new Set(dataRows.map(r => r[0].split(" ")[0]))];
    categories.forEach(c => categoryFilter.innerHTML += `<option>${c}</option>`);
  }

  document.querySelectorAll("th.sortable").forEach(th => {
    th.addEventListener("click", () => {
      const col = th.dataset.col;
      sortState[col] = !sortState[col];

      dataRows.sort((a, b) => {
        return sortState[col] ? a[col].localeCompare(b[col]) : b[col].localeCompare(a[col]);
      });

      th.innerHTML = th.innerText.replace(/ â†‘| â†“/g, "") + (sortState[col] ? " â†‘" : " â†“");
      renderTable(dataRows);
    });
  });

  searchInput.addEventListener("input", searchAndFilter);
  colorFilter.addEventListener("change", searchAndFilter);
  categoryFilter.addEventListener("change", searchAndFilter);
  resetBtn.addEventListener("click", () => location.reload());

  loadSheet();
</script>
</body>
</html>

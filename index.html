<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë°œì£¼ì„œ</title>

<link rel="icon" type="image/png" href="android-icon-48x48.ico" />
<link rel="stylesheet" as="style" crossorigin
  href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --page-bg: #f7f4ff;
  --page-bg2:#eef6ff;

  --card-bg: rgba(255,255,255,.86);
  --card-stroke: rgba(170,150,230,.22);

  --text: #2f2a3a;
  --sub: #6e6a82;
  --muted: #9a96ad;

  --pink: #ff8fbc;
  --pink2:#ffd2e3;
  --lilac:#b8a7ff;

  --shadow-main: 0 18px 50px rgba(30, 18, 60, .10);
  --shadow-card: 0 10px 26px rgba(30, 18, 60, .08);
  --shadow-soft: 0 6px 18px rgba(30, 18, 60, .06);
}

*{box-sizing:border-box;font-family:"Pretendard",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;}
html,body{height:100%;}

body{
  margin:0;
  color:var(--text);
  overflow-x:hidden;
  background:
    radial-gradient(900px 520px at 20% 18%, rgba(255,143,188,.25), transparent 60%),
    radial-gradient(900px 520px at 82% 24%, rgba(184,167,255,.20), transparent 58%),
    radial-gradient(1000px 700px at 55% 92%, rgba(255,210,227,.35), transparent 62%),
    linear-gradient(180deg, var(--page-bg), var(--page-bg2));
}

.container{
  max-width: 1280px;
  margin: 0 auto;
  padding: 34px 18px 44px;
}

.glow{
  position:fixed;
  inset:-20%;
  pointer-events:none;
  filter: blur(70px);
  opacity:.10;
  z-index:0;
}
.glow::before,
.glow::after{
  content:"";
  position:absolute;
  width:620px;height:620px;border-radius:50%;
  left:10%; top:10%;
  background: radial-gradient(circle at 30% 30%, rgba(255,143,188,.55), transparent 60%);
}
.glow::after{
  width:680px;height:680px;
  right:8%; top:12%;
  left:auto;
  background: radial-gradient(circle at 30% 30%, rgba(184,167,255,.50), transparent 62%);
}

/* top bar */
.topbar{
  position:relative;
  z-index:1;
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:16px;
  margin-bottom:14px;
}

.brand{display:flex;flex-direction:column;gap:6px;}
.brand-title{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:20px;
  font-weight:800;
  letter-spacing:-.2px;
  color: var(--text);
}

/* Neon Glass pill (í´ë¦­ ê°€ëŠ¥) */
.pill{
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(255,143,188,.22), rgba(184,167,255,.18));
  border:1px solid rgba(170,150,230,.25);
  color: rgba(47,42,58,.80);
  box-shadow: 0 1px 0 rgba(255,255,255,.55) inset;
}
a.pill{
  text-decoration:none;
  display:inline-flex;
  align-items:center;
}
a.pill:hover{
  border-color: rgba(255,143,188,.55);
  box-shadow: 0 0 0 3px rgba(255,143,188,.14), 0 1px 0 rgba(255,255,255,.55) inset;
}

.meta{
  display:flex;
  align-items:center;
  gap:10px;
  color:var(--sub);
  font-size:12px;
  white-space:nowrap;
}

.dot{
  width:7px;height:7px;border-radius:50%;
  background: rgba(154,150,173,.35);
  box-shadow: 0 0 0 1px rgba(154,150,173,.20) inset;
}
.dot.live{
  background: var(--pink);
  box-shadow: 0 0 0 3px rgba(255,143,188,.20);
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  background: rgba(255,255,255,.55);
  border:1px solid rgba(170,150,230,.18);
  box-shadow: var(--shadow-soft);
}

/* card */
.card{
  position:relative;
  z-index:1;
  background: var(--card-bg);
  border: 1px solid var(--card-stroke);
  border-radius: 22px;
  box-shadow: var(--shadow-main);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  overflow:hidden;
}
.card::before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(900px 260px at 8% 0%, rgba(255,143,188,.18), transparent 60%),
    radial-gradient(900px 260px at 92% 0%, rgba(184,167,255,.14), transparent 55%);
  pointer-events:none;
  opacity:.85;
}
.card-inner{position:relative;padding: 18px 18px 14px;}

/* ===================== âœ… SEARCH UI (ì–„ìŒí•˜ê²Œ) ===================== */
.search-row{
  display:flex;
  gap:12px;
  align-items:center;
  margin: 10px 0 12px;
}

/* ğŸ”¥ ë‘êº¼ìš´ ê²€ìƒ‰ì°½ -> ì–‡ê²Œ */
.search{
  flex:1;
  position:relative;
  display:flex;
  align-items:center;
  gap:8px;
  padding: 8px 44px 8px 12px; /* ì˜¤ë¥¸ìª½ Enter íŒíŠ¸ ê³µê°„ í™•ë³´ */
  border-radius: 14px;
  background: rgba(243,241,250,.82);
  border: 1px solid rgba(170,150,230,.20);
  box-shadow: var(--shadow-soft);
}

/* í¬ì»¤ìŠ¤ë„ ëœ ê³¼í•˜ê²Œ */
.search:focus-within{
  border-color: rgba(255,143,188,.55);
  box-shadow: 0 0 0 3px rgba(255,143,188,.16), var(--shadow-soft);
}

/* âœ… ê²€ì • ë™ê·¸ë¼ë¯¸ ì›ì¸: viewBox ì—†ëŠ” svg + strokeìƒ‰ ë¬¸ì œ
   -> ì œëŒ€ë¡œ ëœ 24px ë‹ë³´ê¸° ì•„ì´ì½˜ìœ¼ë¡œ êµì²´ */
.search-icon{
  width:16px;
  height:16px;
  flex:0 0 auto;
  opacity:.60;
}
.search-icon path{
  stroke: rgba(47,42,58,.65);
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* input ì‘ê²Œ + ë¼ì¸ ë†’ì´ ì •ë¦¬ */
.search input{
  width:100%;
  border:0;
  outline:0;
  background:transparent;
  color:var(--text);
  font-size:12.5px;
  line-height: 1.1;
  padding: 0;
}
.search input::placeholder{
  color: rgba(110,106,130,.55);
}

/* âœ… Enter â†µ ë„ˆë¬´ í° ë¬¸ì œ í•´ê²° */
.enter-hint{
  position:absolute;
  right:12px;
  top:50%;
  transform: translateY(-50%);
  font-size:11px;
  color: rgba(110,106,130,.60);
  user-select:none;
  pointer-events:none;
}

/* status */
.status-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
  font-size:12px;
  color:var(--sub);
}

.table-wrap{
  border-radius:16px;
  border: 1px solid rgba(170,150,230,.18);
  overflow:auto;
  background: rgba(255,255,255,.65);
  box-shadow: 0 1px 0 rgba(255,255,255,.70) inset;
  max-height: 560px;
}

table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  font-size:12px;
}

thead th{
  position: sticky;
  top:0;
  z-index:2;
  text-align:left;
  padding:10px 12px;
  background: rgba(255,255,255,.78);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(170,150,230,.18);
  color: rgba(47,42,58,.88);
  font-weight:700;
  user-select:none;
  cursor:pointer;
}
thead th:first-child{border-top-left-radius:16px; cursor:default;}
thead th:last-child{border-top-right-radius:16px;}

tbody td{
  padding:10px 12px;
  border-bottom:1px solid rgba(170,150,230,.12);
  color: rgba(47,42,58,.86);
}

tbody tr{background: rgba(255,255,255,.48);}
tbody tr:nth-child(even){background: rgba(243,241,250,.55);}
tbody tr:hover{
  background: linear-gradient(90deg, rgba(255,143,188,.22), rgba(184,167,255,.16));
}

.copy{cursor:pointer;}
.copy:active{transform: translateY(0.5px);}

.sort-ind{display:inline-flex;align-items:center;gap:6px;}
.sort-dot{
  width:6px;height:6px;border-radius:50%;
  background: rgba(154,150,173,.40);
  box-shadow: 0 0 0 1px rgba(154,150,173,.18) inset;
}
.sort-dot.on{
  background: var(--pink);
  box-shadow: 0 0 0 3px rgba(255,143,188,.18);
}
.arrow{
  font-size:11px;
  opacity:.9;
  color: rgba(255,143,188,.95);
}

.no-data{
  padding:22px 14px;
  text-align:center;
  color: rgba(110,106,130,.70);
  font-size:12px;
}

#toast{
  position:fixed;
  right:18px;
  bottom:18px;
  z-index:9999;
  padding:10px 12px;
  border-radius:14px;
  background: rgba(255,255,255,.88);
  border:1px solid rgba(255,143,188,.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color: rgba(47,42,58,.92);
  box-shadow: 0 18px 50px rgba(30, 18, 60, .12);
  opacity:0;
  transform: translateY(10px);
  transition: .18s ease;
  pointer-events:none;
}
#toast.show{opacity:1;transform: translateY(0);}

  /* ===== Card Header (Search ìŠ¤íƒ€ì¼) ===== */
.card-header{
  margin-bottom: 12px;
}

.card-title{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:18px;
  font-weight:800;
  letter-spacing:-.2px;
  color: var(--text);
}

/* Search í˜ì´ì§€ë‘ í†¤ ë§ì¶”ê¸° */
.title-text{
  display:flex;
  align-items:center;
}

/* pill ìœ„ì¹˜ ìì—°ìŠ¤ëŸ½ê²Œ */
.card-title .pill{
  margin-left:6px;
}


@media (max-width: 760px){
  .topbar{flex-direction:column; align-items:flex-start;}
  .meta{white-space:normal}
  .table-wrap{max-height: 68vh;}
  .search{ padding-right: 38px; }
  .enter-hint{ right: 10px; }
}
</style>
</head>

<body>
<div class="glow"></div>

<div class="container">
  <div class="card">
  <div class="card-inner">

    <!-- âœ… ì¹´ë“œ ì•ˆ í—¤ë” -->
    <div class="card-header">
      <div class="card-title">
        <span class="title-text">Information</span>
        <a class="pill" href="https://docs.google.com/..." target="_blank">
          DB ì´ë™
        </a>
      </div>
    </div>

    <!-- âœ… ê²€ìƒ‰ ì˜ì—­ -->
    <div class="search-row">
      <div class="search">
        <svg class="search-icon" viewBox="0 0 24 24">
          <path d="M11 19a8 8 0 1 1 0-16a8 8 0 0 1 0 16Z"></path>
          <path d="M21 21l-4.35-4.35"></path>
        </svg>
        <input id="searchInput" type="text" placeholder="ì£¼ë¬¸ë²ˆí˜¸, ìˆ˜ë ¹ì¸, ìƒí’ˆëª…â€¦" />
        <span class="enter-hint">Enter â†µ</span>
      </div>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="table-wrap" id="tableWrapper">
      <div class="no-data">ë°ì´í„° ë¡œë”© ì¤‘â€¦</div>
    </div>

  </div>
</div>


<div id="toast">ë³µì‚¬ë¨</div>

<script>
/* ===================== Config ===================== */
const CSV_URL = "https://docs.google.com/spreadsheets/d/1_Bxfag-90U6u-6JbhxNqeoD9vRns-CpPeXPIJYO1Z5o/export?format=csv&gid=518656308";

const COL = {
  ORDER_NO: 1, MALL: 2, RECEIVER: 3, INVOICE: 5, PHONE: 6,
  PRODUCT: 10, QTY: 11, AMOUNT: 12, COLOR: 18
};

let dataRows = [];
let sortState = { key: null, dir: 1 };

/* ===================== Cache (Local) ===================== */
const CACHE_KEY = "order_csv_cache_v2";
const CACHE_TIME_KEY = "order_csv_cache_time_v2";
const CACHE_TTL_MS = 1000 * 60 * 60 * 6; // 6h

async function fetchWithTimeout(url, timeoutMs = 8000){
  const controller = new AbortController();
  const t = setTimeout(() => controller.abort(), timeoutMs);
  try{
    const res = await fetch(url, { signal: controller.signal });
    if(!res.ok) throw new Error("HTTP " + res.status);
    return await res.text();
  } finally {
    clearTimeout(t);
  }
}

function saveCache(csvText){
  try{
    localStorage.setItem(CACHE_KEY, csvText);
    localStorage.setItem(CACHE_TIME_KEY, String(Date.now()));
  }catch(e){
    console.warn("ìºì‹œ ì €ì¥ ì‹¤íŒ¨:", e);
  }
}
function readCache(){
  const csvText = localStorage.getItem(CACHE_KEY);
  const ts = Number(localStorage.getItem(CACHE_TIME_KEY) || 0);
  if(!csvText) return null;
  return { csvText, ts };
}
function isCacheFresh(ts){ return (Date.now() - ts) <= CACHE_TTL_MS; }

/* ===================== UI Helpers ===================== */
const $ = (id)=>document.getElementById(id);

function debounce(fn, wait=180){
  let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), wait); };
}

function showToast(msg="ë³µì‚¬ë¨"){
  const el = $("toast");
  el.textContent = msg;
  el.classList.add("show");
  setTimeout(()=>el.classList.remove("show"), 850);
}

function toNumber(v){
  const n = String(v ?? "").replace(/[^0-9.-]/g,"");
  return Number(n) || 0;
}

function setHeaderStatus(text){
  $("loadStatus").textContent = text;
}

function setCacheHint(text){
  $("cacheHint").textContent = text || "";
  $("cacheHint").style.color = text ? "rgba(47,42,58,.55)" : "rgba(255,255,255,0)";
}

/* ===================== Data Load ===================== */
async function loadData(){
  setHeaderStatus("DB ë¡œë”© ì¤‘...");
  setCacheHint("");

  const cached = readCache();

  try{
    const csvText = await fetchWithTimeout(CSV_URL, 8000);
    saveCache(csvText);

    Papa.parse(csvText, {
      complete: (results)=>{
        dataRows = results.data.slice(1).filter(r => r && r.length > 1);
        setHeaderStatus(`${dataRows.length.toLocaleString()}ê±´`);
        renderTable([]); // ê²€ìƒ‰ ì „ì—” ë¹„ì›€
      }
    });
  }catch(err){
    console.error(err);

    if(cached){
      const when = new Date(cached.ts).toLocaleString();
      const freshness = isCacheFresh(cached.ts) ? "ìºì‹œ(ìµœì‹ )" : "ìºì‹œ(ì˜¤ë˜ë¨)";
      setHeaderStatus(`DB ì˜¤ë¥˜ â†’ ${freshness}ë¡œ ì¡°íšŒ`);
      setCacheHint(`ìºì‹œ ì‚¬ìš© ì¤‘ Â· ì €ì¥ ì‹œê°: ${when}`);

      Papa.parse(cached.csvText, {
        complete: (results)=>{
          dataRows = results.data.slice(1).filter(r => r && r.length > 1);
          renderTable([]);
        }
      });
      return;
    }

    setHeaderStatus("DB ë¡œë“œ ì‹¤íŒ¨");
    $("tableWrapper").innerHTML =
      '<div class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
  }
}
loadData();

/* ===================== Search + Sort ===================== */
const searchInput = $("searchInput");
let currentRows = [];

function applySearchAndSort(){
  const keyword = searchInput.value.trim().toLowerCase();

  let filtered = dataRows;
  if(keyword){
    filtered = dataRows.filter(row => row.join(" ").toLowerCase().includes(keyword));
  }else{
    renderTable([]);
    return;
  }

  if(sortState.key != null){
    const k = sortState.key;
    const dir = sortState.dir;
    filtered = [...filtered].sort((a,b)=>{
      const av = a[k] ?? "";
      const bv = b[k] ?? "";
      if(k === COL.QTY || k === COL.AMOUNT){
        return (toNumber(av) - toNumber(bv)) * dir;
      }
      return String(av).localeCompare(String(bv), "ko") * dir;
    });
  }

  currentRows = filtered;
  renderTable(currentRows);
}

searchInput.addEventListener("input", debounce(applySearchAndSort, 180));
searchInput.addEventListener("keydown", (e)=>{
  if(e.key === "Escape"){
    searchInput.value = "";
    sortState = { key: null, dir: 1 };
    renderTable([]);
    $("resultCount").textContent = "";
  }
});

/* ===================== Render ===================== */
function headerCell(label, key){
  const isOn = sortState.key === key;
  const arrow = isOn ? (sortState.dir === 1 ? "â–²" : "â–¼") : "";
  return `
    <th data-sort="${key}">
      <span class="sort-ind">
        <span class="sort-dot ${isOn ? "on" : ""}"></span>
        <span>${label}</span>
        <span class="arrow">${arrow}</span>
      </span>
    </th>
  `;
}

function renderTable(rows){
  const wrap = $("tableWrapper");
  const count = $("resultCount");

  if(!rows || rows.length === 0){
    count.textContent = "";
    wrap.innerHTML = '<div class="no-data">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }

  count.textContent = `${rows.length.toLocaleString()}ê±´`;

  let html = `<table>
    <thead><tr>
      <th data-nosort style="cursor:default;">
        <span class="sort-ind"><span class="sort-dot"></span><span>#</span></span>
      </th>
      ${headerCell("ì£¼ë¬¸ë²ˆí˜¸", COL.ORDER_NO)}
      ${headerCell("ì‡¼í•‘ëª°", COL.MALL)}
      ${headerCell("ìˆ˜ë ¹ì¸", COL.RECEIVER)}
      ${headerCell("ì†¡ì¥ë²ˆí˜¸", COL.INVOICE)}
      <th data-nosort style="cursor:default;">
        <span class="sort-ind"><span class="sort-dot"></span><span>ì—°ë½ì²˜</span></span>
      </th>
      ${headerCell("ìƒí’ˆëª…", COL.PRODUCT)}
      ${headerCell("ìˆ˜ëŸ‰", COL.QTY)}
      ${headerCell("ê²°ì œê¸ˆì•¡", COL.AMOUNT)}
      ${headerCell("ì»¬ëŸ¬ì½”ë“œ", COL.COLOR)}
    </tr></thead>
    <tbody>`;

  rows.forEach((r,i)=>{
    html += `<tr>
      <td class="copy">${i+1}</td>
      <td class="copy">${r[COL.ORDER_NO]||""}</td>
      <td class="copy">${r[COL.MALL]||""}</td>
      <td class="copy">${r[COL.RECEIVER]||""}</td>
      <td class="copy">${r[COL.INVOICE]||""}</td>
      <td class="copy">${r[COL.PHONE]||""}</td>
      <td class="copy">${r[COL.PRODUCT]||""}</td>
      <td class="copy">${r[COL.QTY]||""}</td>
      <td class="copy">${r[COL.AMOUNT]||""}</td>
      <td class="copy">${r[COL.COLOR]||""}</td>
    </tr>`;
  });

  html += `</tbody></table>`;
  wrap.innerHTML = html;

  wrap.querySelectorAll(".copy").forEach(cell=>{
    cell.addEventListener("click", ()=>{
      const text = cell.textContent.trim();
      navigator.clipboard.writeText(text)
        .then(()=>showToast("ë³µì‚¬ë¨"))
        .catch(()=>showToast("ë³µì‚¬ ì‹¤íŒ¨"));
    });
  });

  wrap.querySelectorAll("thead th[data-sort]").forEach(th=>{
    th.addEventListener("click", ()=>{
      const key = Number(th.dataset.sort);
      if(sortState.key === key) sortState.dir *= -1;
      else sortState = { key, dir: 1 };

      if(!searchInput.value.trim()){
        renderTable([]);
        return;
      }
      applySearchAndSort();
    });
  });
}
</script>
</body>
</html>
